<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta tags -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="viewport" content="width=device-width" />
    <meta name="theme-color" content="#25282C" />

    <!-- Favicon and title -->
    <link rel="icon" href="./images/touch/favicon.png" />
    <link rel="apple-touch-icon" href="./images/touch/icon192.png" />
    <link rel="manifest" href="./manifest.json" crossorigin="use-credentials" />
    <title>EA Star Wars Battlefront II Community Event Calendar</title>
    <meta
      name="description"
      content="A calendar of current and upcoming events in EA Star Wars Battlefront II (2017)."
    />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://swbf2.events/" />
    <meta
      property="og:title"
      content="EA Star Wars Battlefront II Community Event Calendar"
    />
    <meta
      property="og:description"
      content="A calendar of current and upcoming events in EA Star Wars Battlefront II (2017)."
    />
    <meta
      property="og:image"
      content="https://swbf2.events/images/touch/icon512.png"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://swbf2.events/" />
    <meta
      property="twitter:title"
      content="EA Star Wars Battlefront II Community Event Calendar"
    />
    <meta
      property="twitter:description"
      content="A calendar of current and upcoming events in EA Star Wars Battlefront II (2017)."
    />
    <meta
      property="twitter:image"
      content="https://swbf2.events/images/touch/icon512.png"
    />

    <!-- Halfmoon CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/halfmoon@1.1.1/css/halfmoon-variables.min.css"
      rel="stylesheet"
    />

    <style>
      /* 
        Global scope 
      */
      :root {
        /* Change primary color from blue to indigo */

        --navbar-height: auto;
      }
      .hero {
        height: 75vh;
        /* background: blue; */
      }
      .fab,
      .far,
      .fas {
        margin: 0 0.5rem;
      }
    </style>
  </head>
  <body
    class="with-custom-webkit-scrollbars with-custom-css-scrollbars dark-mode"
    data-dm-shortcut-enabled="true"
    data-set-preferred-mode-onload="true"
  >
    <!-- Modals go here -->
    <!-- Reference: https://www.gethalfmoon.com/docs/modal -->

    <!-- Page wrapper start -->
    <div class="page-wrapper">
      <!-- Content wrapper start -->
      <div class="content-wrapper">
        <!--
        Add your page's main content here
        Examples:
        1. https://www.gethalfmoon.com/docs/content-and-cards/#building-a-page
        2. https://www.gethalfmoon.com/docs/grid-system/#building-a-dashboard
      -->

        <div class="container-fluid">
          <div class="d-flex align-items-center justify-content-center hero">
            <div class="content" style="max-width: 500px">
              <h1 class="content-title text-muted text-center">
                Today's EA Star Wars Battlefront II Event:
              </h1>
              <h2 id="todays-event-name" class="content-title text-center"></h2>
              <p id="todays-event-description" class="text-center"></p>
              <div id="todays-event-game-modes" class="text-center"></div>
              <p class="text-center text-muted countdown"></p>
            </div>
          </div>
        </div>

        <div class="container">
          <div class="row">
            <div class="col-sm-12">
              <h2>Weekly events</h2>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="card p-0">
                <img
                  class="img-fluid rounded-top"
                  loading="lazy"
                  src="./images/swbf2/fast-spawn-event.320w.jpg"
                  srcset="
                    ./images/swbf2/fast-spawn-event.320w.jpg   320w,
                    ./images/swbf2/fast-spawn-event.767w.jpg   768w,
                    ./images/swbf2/fast-spawn-event.1023w.jpg 1024w,
                    ./images/swbf2/fast-spawn-event.1455w.jpg 1320w,
                    ./images/swbf2/fast-spawn-event.1920w.jpg 1456w
                  "
                  alt="Star Wars Battlefront II Event: Fast Spawn Event"
                />
                <div class="content">
                  <h2 class="content-title text-muted m-0">Mondays</h2>
                  <h3 class="content-title">Fast Spawn Event</h3>
                  <p>
                    Spawn timers will be set to 1 sec long in assault modes for
                    the duration of the event.
                  </p>
                  <div>
                    <span class="badge">Galactic Assault</span>
                    <span class="badge">Capital Supremacy</span>
                    <span class="badge">Starfighter Assault</span>
                    <span class="badge">Extraction</span>
                    <span class="badge">Strike</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-12 col-md-6">
              <div class="card p-0">
                <img
                  class="img-fluid rounded-top"
                  loading="lazy"
                  src="./images/swbf2/midweek-boost.320w.jpg"
                  srcset="
                    ./images/swbf2/midweek-boost.320w.jpg   320w,
                    ./images/swbf2/midweek-boost.767w.jpg   768w,
                    ./images/swbf2/midweek-boost.1023w.jpg 1024w,
                    ./images/swbf2/midweek-boost.1455w.jpg 1320w,
                    ./images/swbf2/midweek-boost.1920w.jpg 1456w
                  "
                  alt="Star Wars Battlefront II Event: Midweek Boost"
                />
                <div class="content">
                  <h2 class="content-title text-muted m-0">Wednesdays</h2>
                  <h3 class="content-title">Midweek Boost</h3>
                  <p>Triple XP for faster ranking progression.</p>
                  <div>
                    <span class="badge">All game modes</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-12 col-md-6">
              <div class="card p-0">
                <img
                  class="img-fluid rounded-top"
                  loading="lazy"
                  src="./images/swbf2/battle-point-event.320w.jpg"
                  srcset="
                    ./images/swbf2/battle-point-event.320w.jpg   320w,
                    ./images/swbf2/battle-point-event.767w.jpg   768w,
                    ./images/swbf2/battle-point-event.1023w.jpg 1024w,
                    ./images/swbf2/battle-point-event.1455w.jpg 1320w,
                    ./images/swbf2/battle-point-event.1920w.jpg 1456w
                  "
                  alt="Star Wars Battlefront II Event: Battle Point Event"
                />
                <div class="content">
                  <h2 class="content-title text-muted m-0">Fridays</h2>
                  <h3 class="content-title">Battle Point Event</h3>
                  <p>
                    Lower Battle Point costs for all reinforcements and
                    increased numbers allowed at a time.
                  </p>
                  <div>
                    <span class="badge">Galactic Assault</span>
                    <span class="badge">Capital Supremacy</span>
                    <span class="badge">Extraction</span>
                    <span class="badge">Strike</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-12 col-md-6">
              <div class="card p-0">
                <img
                  class="img-fluid rounded-top"
                  loading="lazy"
                  src="./images/swbf2/weekend-boost.320w.jpg"
                  srcset="
                    ./images/swbf2/weekend-boost.320w.jpg   320w,
                    ./images/swbf2/weekend-boost.767w.jpg   768w,
                    ./images/swbf2/weekend-boost.1023w.jpg 1024w,
                    ./images/swbf2/weekend-boost.1455w.jpg 1320w,
                    ./images/swbf2/weekend-boost.1920w.jpg 1456w
                  "
                  alt="Star Wars Battlefront II Event: Weekend Boost"
                />
                <div class="content">
                  <h2 class="content-title text-muted m-0">
                    Saturdays + Sundays
                  </h2>
                  <h3 class="content-title">Weekend Boost</h3>
                  <p>Double XP for faster ranking progression.</p>
                  <div>
                    <span class="badge">All game modes</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <h2>Special events</h2>
            </div>
            <div class="col-sm-12 col-md-6">
              <div class="card p-0">
                <img
                  class="img-fluid rounded-top"
                  loading="lazy"
                  src="./images/swbf2/battle-point-event-unlimited-power.320w.jpg"
                  srcset="
                    ./images/swbf2/battle-point-event-unlimited-power.320w.jpg   320w,
                    ./images/swbf2/battle-point-event-unlimited-power.767w.jpg   768w,
                    ./images/swbf2/battle-point-event-unlimited-power.1023w.jpg 1024w,
                    ./images/swbf2/battle-point-event-unlimited-power.1455w.jpg 1320w,
                    ./images/swbf2/battle-point-event-unlimited-power.1920w.jpg 1456w
                  "
                  alt="Star Wars Battlefront II Event: Battle Point Event: Unlimited Power"
                />
                <div class="content">
                  <h2 class="content-title text-muted m-0">
                    Jan 1st + May 4th
                  </h2>
                  <h3 class="content-title">
                    Battle Point Event: Unlimited Power
                  </h3>
                  <p>
                    90% off the Battle Point cost for everything, increased
                    number of Reinforcements and Heroes available
                    simultaneously, with Fast Spawn timers and Double XP in
                    effect.
                  </p>
                  <div>
                    <span class="badge">Galactic Assault</span>
                    <span class="badge">Capital Supremacy</span>
                    <span class="badge">Extraction</span>
                    <span class="badge">Strike</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="container">
          <div class="row">
            <div class="col-sm-12 text-center">
              <h2>About</h2>
            </div>
            <div class="col-sm-12">
              <div
                style="margin: auto; max-width: 500px"
                class="content text-center"
              >
                <p>
                  A community calendar of current and upcoming events in EA Star
                  Wars Battlefront II (2017). See today's SWBF2 event, and the
                  upcoming event schedule.
                </p>
                <p>
                  Events start at 00:01am CET and conclude the following day at
                  06:00am CET for a total of 30 hours.
                </p>
              </div>
            </div>
          </div>
        </div>

        <nav
          class="navbar navbar-static-bottom justify-content-between p-10 flex-column"
        >
          <div class="navbar-text">
            <div>
              Made with <i class="fab fa-galactic-republic"></i> by&nbsp;
              <a href="https://joeduncko.com" target="_blank" rel="noopener"
                >Joe Duncko</a
              >
            </div>
          </div>

          <div class="navbar-text">
            <div>
              Star Wars Battlefront II
              <i class="far fa-copyright"></i> Electronic Arts Inc.
            </div>
          </div>

          <div class="navbar-text">
            <a
              href="https://github.com/JoeDuncko/easwbf2-events"
              target="_blank"
              referrerpolicy="origin"
              rel="noopener"
              ><i class="fas fa-code-branch"></i
            ></a>
            <a
              href="https://simpleanalytics.com/swbf2.events?utm_source=swbf2.events"
              target="_blank"
              referrerpolicy="origin"
              rel="noopener"
              ><i class="fas fa-chart-bar"></i
            ></a>
          </div>
        </nav>
      </div>
      <!-- Content wrapper end -->
    </div>
    <!-- Page wrapper end -->

    <!-- Halfmoon JS -->
    <script src="https://cdn.jsdelivr.net/npm/halfmoon@1.1.1/js/halfmoon.min.js"></script>
    <script
      src="https://kit.fontawesome.com/440750a10d.js"
      crossorigin="anonymous"
    ></script>
    <script type="module">
      import {
        isMonday,
        isTuesday,
        isWednesday,
        isThursday,
        isFriday,
        isSaturday,
        isSunday,
        isToday,
        addDays,
        addHours,
        startOfDay,
        endOfDay,
      } from "https://esm.run/date-fns";

      import {
        zonedTimeToUtc,
        utcToZonedTime,
      } from "https://esm.run/date-fns-tz";

      // TODO: fuse getEndOfEvent and isEventRunning and getBeginningOfEvent
      const events = [
        {
          isEventRunning: (date) => {
            const jan1st = new Date(`1-1-${new Date().getFullYear()}`);
            const jan2nd = new Date(`1-2-${new Date().getFullYear()}`);
            const may4th = new Date(`5-4-${new Date().getFullYear()}`);
            const may5th = new Date(`5-5-${new Date().getFullYear()}`);

            return (
              isToday(jan1st) ||
              (isToday(jan2nd) && date.getHours() < 6) ||
              isToday(may4th) ||
              (isToday(may5th) && date.getHours() < 6)
            );
          },
          getEndOfEvent: (date) => {
            const jan1st = new Date(`1-1-${new Date().getFullYear()}`);
            const jan2nd = new Date(`1-2-${new Date().getFullYear()}`);
            const may4th = new Date(`5-4-${new Date().getFullYear()}`);
            const may5th = new Date(`5-5-${new Date().getFullYear()}`);

            return (
              isToday(jan1st) ||
              (isToday(jan2nd) && date.getHours() < 6) ||
              isToday(may4th) ||
              (isToday(may5th) && date.getHours() < 6)
            );

            if (isToday(jan1st)) {
              return addHours(endOfDay(date), 6);
            } else if (isToday(jan2nd) && date.getHours() < 6) {
              return addHours(startOfDay(date), 6);
            } else if (isToday(may4th)) {
              return addHours(endOfDay(date), 6);
            } else if (isToday(may5th) && date.getHours() < 6) {
              return addHours(startOfDay(date), 6);
            }
          },
          name: "Battle Point Event: Unlimited Power",
          description:
            "90% off the Battle Point cost for everything, increased number of Reinforcements and Heroes available simultaneously, with Fast Spawn timers and Double XP in effect.",
          gameModes: [
            "Galactic Assault",
            "Capital Supremacy",
            "Extraction",
            "Strike",
          ],
        },
        {
          isEventRunning: (date) =>
            isMonday(date) || (isTuesday(date) && date.getHours() < 6),
          getEndOfEvent: (date) => {
            if (isMonday(date)) {
              return addHours(endOfDay(date), 6);
            } else if (isTuesday(date) && date.getHours() < 6) {
              return addHours(startOfDay(date), 6);
            }
          },
          name: "Fast Spawn Event",
          description:
            "Spawn timers will be set to 1 sec long in assault modes for the duration of the event.",
          gameModes: [
            "Galactic Assault",
            "Capital Supremacy",
            "Starfighter Assault",
            "Extraction",
            "Strike",
          ],
        },
        {
          isEventRunning: (date) =>
            isWednesday(date) || (isThursday(date) && date.getHours() < 6),
          getEndOfEvent: (date) => {
            if (isWednesday(date)) {
              return addHours(endOfDay(date), 6);
            } else if (isThursday(date) && date.getHours() < 6) {
              return addHours(startOfDay(date), 6);
            }
          },
          name: "Midweek Boost",
          description: "Triple XP for faster ranking progression.",
          gameModes: ["All game modes"],
        },
        {
          isEventRunning: (date) =>
            isFriday(date) || (isSaturday(date) && date.getHours() < 6),
          getEndOfEvent: (date) => {
            if (isFriday(date)) {
              return addHours(endOfDay(date), 6);
            } else if (isSaturday(date) && date.getHours() < 6) {
              return addHours(startOfDay(date), 6);
            }
          },
          name: "Battle Point Event",
          description:
            "Lower Battle Point costs for all reinforcements and increased numbers allowed at a time.",
          gameModes: [
            "Galactic Assault",
            "Capital Supremacy",
            "Extraction",
            "Strike",
          ],
        },
        {
          isEventRunning: (date) =>
            isSaturday(date) ||
            isSunday(date) ||
            (isMonday(date) && date.getHours() < 6),
          getEndOfEvent: (date) => {
            if (isSaturday(date)) {
              return addHours(endOfDay(date), 30);
            } else if (isSunday(date)) {
              return addHours(endOfDay(date), 6);
            } else if (isMonday(date) && date.getHours() < 6) {
              return addHours(startOfDay(date), 6);
            }
          },
          name: "Weekend Boost",
          description: "Double XP for faster ranking progression.",
          gameModes: ["All game modes"],
        },
      ];

      const getNow = () => utcToZonedTime(new Date(), "Europe/Stockholm"); // everything must be in CET since Dice is based in Sweden
      // const getNow = () => new Date("Mon Jan 25 2021 01:00:00 GMT-0500"); // Test date, for testing

      const findNextEvent = (now) => {
        let nextEvent;
        let nextEventDate = startOfDay(now);
        do {
          nextEventDate = addDays(nextEventDate, 1);
          nextEvent = events.find((event) =>
            event.isEventRunning(nextEventDate)
          );
        } while (!nextEvent);

        return { nextEvent, nextEventDate };
      };

      // See https://stackoverflow.com/a/36592979/3438861
      const setIntervalImmediately = (func, interval) => {
        func();
        return setInterval(func, interval);
      };

      const createCountdown = ({
        event,
        countdownDate,
        countdownText,
        doneText,
      }) => {
        const countdown = setIntervalImmediately(() => {
          // Need to get new time every interval
          const nowTime = getNow().getTime();

          // Set the date we're counting down to
          const countdownTime = countdownDate.getTime();

          // Find the distance between now and the count down time
          const distance = countdownTime - nowTime;

          // Time calculations for days, hours, minutes and seconds
          const days = Math.floor(distance / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
          );
          const minutes = Math.floor(
            (distance % (1000 * 60 * 60)) / (1000 * 60)
          );
          const seconds = Math.floor((distance % (1000 * 60)) / 1000);

          const countdownDOM = document.querySelector(".countdown");

          countdownDOM.innerHTML = `${countdownText} ${days}d ${hours}h ${minutes}m ${seconds}s`;

          // If the count down is finished
          if (distance < 0) {
            clearInterval(countdown);
            countdownDOM.innerHTML = doneText;
          }
        }, 1000);
      };

      const now = getNow();

      const todaysEvent = events.find((event) => event.isEventRunning(now));

      const todaysEventNameDOM = document.querySelector("#todays-event-name");
      const todaysEventDescriptionDOM = document.querySelector(
        "#todays-event-description"
      );
      const todaysEventGameModesDOM = document.querySelector(
        "#todays-event-game-modes"
      );

      if (todaysEvent) {
        const gameModesHTML = todaysEvent.gameModes
          .map((gameMode) => `<span class="badge m-5">${gameMode}</span>`)
          .join("");

        createCountdown({
          event: todaysEvent,
          countdownDate: todaysEvent.getEndOfEvent(now),
          countdownText: "Time remaining: ",
          doneText: "Event ending...",
        });

        todaysEventNameDOM.innerHTML = todaysEvent.name;
        todaysEventDescriptionDOM.innerHTML = todaysEvent.description;
        todaysEventGameModesDOM.innerHTML = gameModesHTML;
      } else {
        const { nextEvent, nextEventDate } = findNextEvent(now);

        createCountdown({
          event: nextEvent,
          countdownDate: nextEventDate,
          countdownText: "In",
          doneText: "Starting now...",
        });

        todaysEventNameDOM.innerHTML = `Next event: ${nextEvent.name}`;
      }
    </script>
    <script>
      // Check that service workers are supported
      if ("serviceWorker" in navigator) {
        // Use the window load event to keep the page load performant
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("./sw.js");
        });
      }
    </script>

    <script async defer src="https://sa.swbf2.events/latest.js"></script>
    <noscript
      ><img src="https://sa.swbf2.events/noscript.gif" alt=""
    /></noscript>
  </body>
</html>
